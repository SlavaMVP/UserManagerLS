/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var e={tableBody:document.querySelector("#table__body"),userForm:document.querySelector("#user-form"),submitButton:document.querySelector("#submit-button"),usersTable:document.querySelector("#user-table"),subHeader:document.querySelector("#sub-header"),loaderPlaceholder:document.querySelector("#loader"),totalUsersNum:document.querySelector(".info__total"),perPageUsersNum:document.querySelector(".info__perpage"),pagination:document.querySelector(".pagination"),nextPaginationBtn:document.querySelector(".button--next"),prevPaginationBtn:document.querySelector(".button--prev"),exitEditModeBtn:document.querySelector("#exit-btn"),rowTemplate:document.querySelector("#row-template"),errorMessageNode:document.querySelectorAll(".error-message")};function t(t){t?e.exitEditModeBtn.classList.remove("hide"):e.exitEditModeBtn.classList.add("hide"),e.submitButton.innerText=t?"Сохранить изменения":"Добавить нового пользователя"}function r(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function n(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var s={userList:[],isFormValid:!0,isEditMode:!1,curentUserId:null,isLoading:!0,totalUsersNumber:0,totalPagesNumber:1,usersPerPage:5,curentPage:1,filteredBy:"phone-number"};function o(e,t){var r,n=function(e){if(Array.isArray(e))return i(e)}(r=t.userList)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(r)||function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}();n=n.filter((function(t){return t.id!=e})),t.userList=n}function u(e,t){t.isEditMode=e}function l(e,t){t.curentUserId=e||null}function d(e,t){"phone-number"===t?e.userList.sort((function(e,t){return e.tel-t.tel})):t&&e.userList.sort((function(e,r){var n=e[t].toLowerCase(),a=r[t].toLowerCase();return n<a?-1:n>a?1:0}))}function c(e,t,r){r.setItem(e,t)}function m(e,t){var r=t.getItem(e);return t===localStorage&&(r=JSON.parse(r)),r}function v(t){var r=e.rowTemplate.content.cloneNode(!0);r.querySelector("#uPhone").innerText=t.tel,r.querySelector("#uName").innerText=t.name,r.querySelector("#uEmail").innerText=t.email,r.querySelector("#uAddress").innerText=t.address;var n=r.querySelector("#uButtons");n.querySelector(".btn--edit").setAttribute("data-id",t.id),n.querySelector(".btn--delete").setAttribute("data-id",t.id),e.tableBody.appendChild(r)}function f(e){e.user_phone.value="",e.user_fullname.value="",e.user_email.value="",e.user_address.value=""}var g=function e(t,r,n,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tel=t,this.name=r,this.email=n,this.address=a},p={telephone:{inputVal:"",required:!0,minLength:11,valid:!1},name:{inputVal:"",required:!0,fullName:!0,valid:!1},email:{inputVal:"",required:!0,valid:!1,regexp:/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/},address:{inputVal:"",required:!0,valid:!1}};function b(t){var r=0;for(var n in function(e){p.name.inputVal=e["user-name"].value,p.email.inputVal=e["user-email"].value,p.address.inputVal=e["user-address"].value,p.telephone.inputVal=e.user_phone.value}(t),p)h(n,r),r++;if(p.name.valid&&p.email.valid&&p.telephone.valid&&p.address.valid)return e.userForm.classList.remove("invalid"),!0}function h(t,r){var n="",a=p[t].inputVal;p[t].minLength&&(a.length<p[t].minLength||a.length>p[t].minLength)&&(p[t].valid=!1,n="Длина номера должна быть ".concat(p[t].minLength," цифр"),e.userForm.classList.add("invalid")),p[t].regexp&&(p[t].regexp.test(String(a).toLowerCase())||(p[t].valid=!1,n="Введите валидный эмейл (name@gmail.com)",e.userForm.classList.add("invalid"))),p[t].fullName&&2!==a.trim().split(" ").length&&(p[t].valid=!1,n="Введите имя и фамилию (Игорь Петров)",e.userForm.classList.add("invalid")),p[t].required&&!a.trim()&&(p[t].valid=!1,n="Поле не должно быть пустым",e.userForm.classList.add("invalid")),n.trim()||(p[t].valid=!0),function(t,r){e.errorMessageNode[r].innerText=t}(n,r)}var y=localStorage,P=sessionStorage;function L(e){var t=e.target.dataset.goTo;"forward"===t&&s.curentPage!==s.totalPages?s.curentPage=s.curentPage+1:"backward"===t&&1!==s.curentPage&&(s.curentPage=s.curentPage-1),S(s)}function S(t){var r,n,a,i,o;t.isLoading=!0,t.isLoading&&(function(e){e.totalUsersNumber=e.userList.length}(t),function(e){e.totalUsersNumber?e.totalPagesNumber=Math.ceil(e.totalUsersNumber/e.usersPerPage):e.totalPagesNumber=1}(t),function(t){e.totalUsersNum.innerHTML="<p>Всего в таблице <b>".concat(t.totalUsersNumber,"</b></p>"),e.perPageUsersNum.innerHTML="<p>Показано на странице ".concat(t.totalUsersNumber<t.usersPerPage?t.totalUsersNumber:t.usersPerPage,"</p>")}(t),e.loaderPlaceholder.insertAdjacentHTML("afterbegin",'\n  <div class="lds-roller"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>\n  '),new Promise((function(e,t){setTimeout((function(){var t;e(((t=document.querySelector(".lds-roller"))&&t.parentElement.removeChild(t),!1))}),50)})).then((function(r){t.isLoading=r,function(t){t.totalUsersNumber?(e.subHeader.classList.add("hide"),e.usersTable.classList.remove("hide")):(e.subHeader.classList.remove("hide"),e.usersTable.classList.add("hide"))}(t)}))),t.totalPagesNumber<t.curentPage&&(t.curentPage=t.totalPagesNumber),e.subHeader.classList.add("hide"),e.usersTable.classList.add("hide"),e.tableBody.innerHTML="",r=t.userList,n=t.usersPerPage,i=((a=t.curentPage)-1)*n,o=a*n,r.slice(i,o).forEach(v),function(t,r,n){var a=Math.ceil(r/n);1===t&&a>1?(e.nextPaginationBtn.classList.remove("hide"),e.prevPaginationBtn.classList.add("hide")):t<a?(e.nextPaginationBtn.classList.remove("hide"),e.prevPaginationBtn.classList.remove("hide")):t===a&&a>1?(e.nextPaginationBtn.classList.add("hide"),e.prevPaginationBtn.classList.remove("hide")):(e.nextPaginationBtn.classList.add("hide"),e.prevPaginationBtn.classList.add("hide"))}(a,s.totalUsersNumber,s.usersPerPage),c("onPage",a,P)}document.addEventListener("DOMContentLoaded",(function(){y.length&&(s.userList=function(e){var t,r=[];for(var n in e)(t=e.getItem(n))&&((t=JSON.parse(t)).id=n,r.push(t));return r}(y),s.curentPage=+m("onPage",P)||s.curentPage,s.filteredBy=m("filter",P)||s.filteredBy,d(s,s.filteredBy),S(s))})),e.usersTable.addEventListener("click",(function(r){var n,a,i=r.target.dataset.action||null,v=r.target.dataset.id||null,f=r.target.dataset.sortBy||null;"delete"===i?(a=s,function(e,t){t.removeItem(e)}(n=v,y),o(n,a),S(s)):"edit"===i&&(function(t,r,n){var a,i;i=m(t,r),(a=e.userForm).user_phone.value=i.tel,a.user_fullname.value=i.name,a.user_email.value=i.email,a.user_address.value=i.address,l(t,n),u(!0,n)}(v,y,s),b(e.userForm),t(!0)),f&&(s.filteredBy=f,d(s,f),S(s),c("filter",f,P))})),e.submitButton.addEventListener("click",(function(r){if(r.preventDefault(),s.isFormValid=b(e.userForm),s.isFormValid){var a=(h=e.userForm,new g(h.user_phone.value,h.user_fullname.value,h.user_email.value,h.user_address.value));i=s.curentUserId,m=a,v=y,null!==(p=i)?(o(p,s),u(!1,s),t(!1)):p=(new Date).getTime(),function(e,t,r){c(t,JSON.stringify(e),r)}(m,p,v),function(e,t,r){e.userList.push(n(n({},t),{},{id:r}))}(s,m,p),l(null,s),d(s,s.filteredBy),f(e.userForm),S(s)}var i,m,v,p,h})),e.exitEditModeBtn.addEventListener("click",(function(r){r.preventDefault(),l(null,s),f(e.userForm),u(!1,s),t(!1)})),e.nextPaginationBtn.addEventListener("click",L),e.prevPaginationBtn.addEventListener("click",L)})();